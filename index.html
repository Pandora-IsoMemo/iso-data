<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data for MPI Iso App • MpiIsoData</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Data for MPI Iso App">
<meta name="description" content="This package provides access to databases to use in the MPI Iso App. It also ships with fallback datasets.">
<meta property="og:description" content="This package provides access to databases to use in the MPI Iso App. It also ships with fallback datasets.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">MpiIsoData</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">23.03.2.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="isomemo-data-package-iso-data">IsoMemo Data Package (iso-data)<a class="anchor" aria-label="anchor" href="#isomemo-data-package-iso-data"></a>
</h1></div>
<div class="section level2">
<h2 id="infrastructure">Infrastructure<a class="anchor" aria-label="anchor" href="#infrastructure"></a>
</h2>
<div class="float">
<img src="https://user-images.githubusercontent.com/16759098/216335554-864c2d9b-0200-48f5-b6b7-975f66b1fe74.png" alt="Infrastructure"><div class="figcaption">Infrastructure</div>
</div>
</div>
<div class="section level2">
<h2 id="content">Content<a class="anchor" aria-label="anchor" href="#content"></a>
</h2>
<p>This ReadMe contains instructions on how to:</p>
<ul>
<li><a href="#add-a-new-data-source">Add a New Data Source</a></li>
<li><a href="#modify-an-existing-data-source">Modify an Existing Data Source</a></li>
<li><a href="#etl-process-of-the-data-sources">ETL process of the Data Sources</a></li>
<li><a href="#access-to-data">Access to Data</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="add-a-new-data-source">Add a New Data Source<a class="anchor" aria-label="anchor" href="#add-a-new-data-source"></a>
</h2>
<p>There are two ways to add a new data source depending on where data is retrieved from:</p>
<ol style="list-style-type: decimal">
<li>data source retrieved from a <strong>mySql database</strong> -&gt; execute function <code><a href="reference/createNewDBSource.html">createNewDBSource()</a></code>
</li>
<li>data source retrieved from a <strong>local or remote file</strong> -&gt; execute function <code><a href="reference/createNewFileSource.html">createNewFileSource()</a></code>
</li>
</ol>
<p>Executing one of the functions</p>
<ul>
<li>
<code><a href="reference/createNewDBSource.html">createNewDBSource()</a></code> or</li>
<li><code><a href="reference/createNewFileSource.html">createNewFileSource()</a></code></li>
</ul>
<p>will automatically:</p>
<ol style="list-style-type: decimal">
<li>create a new file <code>R/02-&lt;datasource&gt;.R</code> that contains the function to extract the data: <code>extract.&lt;datasource&gt;()</code>,</li>
<li>add a new entry for the source into the file <code>R/00-databases.R</code>,</li>
<li>(only for mySql databases) create/update the <code>.Renviron</code> file that contains database credentials.</li>
</ol>
<p>The Files <code>R/02-&lt;datasource&gt;.R</code> for different data sources may contain individual and extensive data preparations that can be adjusted manually. For details compare e.g. <code>R/02-LiVES.R</code>, and read the section <a href="#modify-an-existing-data-source">Modify An Existing Data Source</a>.</p>
<div class="section level3">
<h3 id="specify-the-type-of-data-and-the-data-mapping">Specify the type of data and the data mapping<a class="anchor" aria-label="anchor" href="#specify-the-type-of-data-and-the-data-mapping"></a>
</h3>
<p>For both ways to add data sources (from <strong>database</strong> or from <strong>file</strong>), four mandatory parameters must be specified:</p>
<ul>
<li>
<code>dataSourceName</code>: (character) name of the new data source, something like “xyDBname”, “14CSea”, “CIMA”, “IntChron”, “LiVES”. The name of the source must be contained exactly as a column name in the mapping file.</li>
<li>
<code>datingType</code>: (character) dating type for the database, e.g. “radiocarbon” or “expert”</li>
<li>
<code>coordType</code>: (character) coordinate type of latitude and longitude columns, one of
<ul>
<li>“decimal degrees”, e.g. <code>40.446</code> or <code>79.982</code>,</li>
<li>“degrees decimal minutes”, e.g. <code>40° 26.767' N</code> or <code>79° 58.933' W</code>,</li>
<li>“degrees minutes seconds”, e.g. <code>40° 26' 46'' N</code> or <code>79° 58' 56'' W</code>
</li>
</ul>
</li>
<li>
<code>mappingName</code>: (character) name of the mapping without file extension, e.g. “IsoMemo”. The mapping (a .csv file) must be available under “inst/mapping/”.</li>
</ul>
</div>
<div class="section level3">
<h3 id="specify-the-data-source">Specify the data source<a class="anchor" aria-label="anchor" href="#specify-the-data-source"></a>
</h3>
<div class="section level4">
<h4 id="mysql-database">MySql database:<a class="anchor" aria-label="anchor" href="#mysql-database"></a>
</h4>
<p>Here, database credentials <code>&lt;dbName&gt;, &lt;dbUser&gt;, &lt;dbPassword&gt;, &lt;dbHost&gt;, &lt;dbPort&gt;</code> and the <code>&lt;tableName&gt;</code> must be specified. The credentials are not to be stored on Github, they will not be stored in any file that will be uploaded to Github. The credentials are only needed for local development and for testing the database connection.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">createNewDBSource</span>(<span class="at">dataSourceName =</span> <span class="sc">&lt;</span>datasource<span class="sc">&gt;</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>                  <span class="at">datingType =</span> <span class="sc">&lt;</span>datingType<span class="sc">&gt;</span>,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                  <span class="at">coordType =</span> <span class="sc">&lt;</span>coordType<span class="sc">&gt;</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>                  <span class="at">mappingName =</span> <span class="sc">&lt;</span>mappingName<span class="sc">&gt;</span>,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>                  <span class="at">dbName =</span> <span class="sc">&lt;</span>dbName<span class="sc">&gt;</span>,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>                  <span class="at">dbUser =</span> <span class="sc">&lt;</span>dbUser<span class="sc">&gt;</span>,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>                  <span class="at">dbPassword =</span> <span class="sc">&lt;</span>dbPassword<span class="sc">&gt;</span>,</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>                  <span class="at">dbHost =</span> <span class="sc">&lt;</span>dbHost<span class="sc">&gt;</span>,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>                  <span class="at">dbPort =</span> <span class="sc">&lt;</span>dbPort<span class="sc">&gt;</span>,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>                  <span class="at">tableName =</span> <span class="sc">&lt;</span>tableName<span class="sc">&gt;</span>)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="file">File:<a class="anchor" aria-label="anchor" href="#file"></a>
</h4>
<p>Data can be loaded either</p>
<ul>
<li>from a <strong>local file</strong> that must be stored in the <code>inst/extdata'</code> folder, or</li>
<li>from a <strong>remote file</strong>, the <code>&lt;remotePath&gt;</code> must be given, e.g. <code>"http://www.14sea.org/img/"</code>
</li>
</ul>
<p>Please set <code>&lt;location&gt; = "local"</code> in the first case, and <code>&lt;location&gt; = "remote"</code> in the second case.</p>
<p>Please, provide the <code>&lt;filename&gt;</code> with extension (only <code>*.csv</code> or <code>*.xlsx</code> are supported), e.g.  <code>"data.csv"</code>, <code>"14SEA_Full_Dataset_2017-01-29.xlsx"</code></p>
<p>Optionally, the following can be specified</p>
<ul>
<li>for <code>.xlsx</code> files, a <code>&lt;sheetNumber&gt;</code> as integer value</li>
<li>for <code>.csv</code> files, <code>&lt;sep&gt;</code> for field separator character, and <code>&lt;dec&gt;</code> for the character used for decimal points</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">createNewFileSource</span>(<span class="at">dataSourceName =</span> <span class="sc">&lt;</span>datasource<span class="sc">&gt;</span>,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>                    <span class="at">datingType =</span> <span class="sc">&lt;</span>datingType<span class="sc">&gt;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>                    <span class="at">coordType =</span> <span class="sc">&lt;</span>coordType<span class="sc">&gt;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>                    <span class="at">mappingName =</span> <span class="sc">&lt;</span>mappingName<span class="sc">&gt;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>                    <span class="at">fileName =</span> <span class="sc">&lt;</span>filename<span class="sc">&gt;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>                    <span class="at">locationType =</span> <span class="sc">&lt;</span>location<span class="sc">&gt;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>                    <span class="at">remotePath =</span> <span class="sc">&lt;</span>remotePath<span class="sc">&gt;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>                    <span class="at">sheetNumber =</span> <span class="dv">1</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">";"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>                    <span class="at">dec =</span> <span class="st">","</span>)</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="modify-an-existing-data-source">Modify an Existing Data Source<a class="anchor" aria-label="anchor" href="#modify-an-existing-data-source"></a>
</h2>
<p>Data extraction for all data sources are defined in the files <code>R/02-&lt;datasource&gt;.R</code>. Within the function <code>extract.&lt;datasource&gt;()</code> you can retrieve data, modify values as you like. You only need to ensure these points:</p>
<ul>
<li>(<em>done automatically</em>) the function name needs to be <code>extract.&lt;datasource&gt;</code>. <code>&lt;datasource&gt;</code> needs to match the entry <code>name</code> in the file <code>R/00-databases.R</code>
</li>
<li>the function needs to have a single argument <code>x</code>. <code>x</code> holds all configuration from the entry in <code>R/00-databases.R</code>
</li>
<li>the retrieved data needs to be a single data.frame. Assign this to the list element <code>x$dat</code> and return <code>x</code>
</li>
<li>only variables in the data frame which are part of the mapping <code>&lt;mappingId&gt;</code> that must be available under <code>inst/mapping/&lt;mappingId&gt;.csv</code> and that is specified in <code>R/00-databases.R</code> will be processed.</li>
</ul>
<p>A minimal example of the extract function looks like this</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extract.testdb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="co"># dummy dataset</span></span>
<span></span>
<span>    <span class="va">x</span><span class="op">$</span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="co"># assign data to list element x$dat</span></span>
<span></span>
<span>    <span class="va">x</span> <span class="co"># return x</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="etl-process-of-the-data-sources">ETL process of the Data Sources<a class="anchor" aria-label="anchor" href="#etl-process-of-the-data-sources"></a>
</h2>
<div class="section level3">
<h3 id="test-the-etl-process">Test the ETL process<a class="anchor" aria-label="anchor" href="#test-the-etl-process"></a>
</h3>
<p>Run the following commands in R to install the package locally and run the extract function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># install package locally</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># load all functions from package</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">etlTest</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Inspect the results in test. Data from the nth datasource will be in the element <code>res[[n]]$dat</code></p>
<p>IMPORTANT: Only 5 rows will be processed during the test! If you want to process all data specify <code>full = TRUE</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">etlTest</span><span class="op">(</span>full <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>To test only the n-th datasource execute the function like this</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">etlTest</span><span class="op">(</span><span class="fu">databases</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="va">n</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Results will be in the object res[[1]]$dat</p>
</div>
<div class="section level3">
<h3 id="test-the-code">Test the Code<a class="anchor" aria-label="anchor" href="#test-the-code"></a>
</h3>
<p>Test your code by running</p>
<pre><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="deployment">Deployment<a class="anchor" aria-label="anchor" href="#deployment"></a>
</h3>
<p>Code from the main branch will be automatically deployed to the production system on the MPI server (given successful <code><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">devtools::check()</a></code>) and will be on the main version of the API and App.</p>
<p>Respectively, code from the beta branch will be automatically deployed to the beta version of the API and App.</p>
</div>
</div>
<div class="section level2">
<h2 id="access-to-data">Access to Data<a class="anchor" aria-label="anchor" href="#access-to-data"></a>
</h2>
<p>data is returned in JSON format</p>
<ul>
<li>IsoData: <a href="https://isomemodb.com/api/v1/iso-data" class="external-link uri">https://isomemodb.com/api/v1/iso-data</a>
</li>
<li>IsoData (beta): <a href="https://isomemodb.com/testapi/v1/iso-data" class="external-link uri">https://isomemodb.com/testapi/v1/iso-data</a>
</li>
</ul>
<p>You can use the following parameters:</p>
<ul>
<li>dbsource</li>
<li>category</li>
<li>field</li>
</ul>
<p>Example call:</p>
<p><a href="https://isomemodb.com/api/v1/iso-data?dbsource=LiVES&amp;category=Location&amp;field=site,longitude" class="external-link uri">https://isomemodb.com/api/v1/iso-data?dbsource=LiVES&amp;category=Location&amp;field=site,longitude</a></p>
<p>Helper endpoints</p>
<ul>
<li>Databases: <a href="https://isomemodb.com/api/v1/dbsources" class="external-link uri">https://isomemodb.com/api/v1/dbsources</a>
</li>
<li>Databases (beta): <a href="https://isomemodb.com/testapi/v1/dbsources" class="external-link uri">https://isomemodb.com/testapi/v1/dbsources</a>
</li>
<li>Mapping: <a href="https://isomemodb.com/api/v1/mapping" class="external-link uri">https://isomemodb.com/api/v1/mapping</a>
</li>
<li>Mapping (beta): <a href="https://isomemodb.com/testapi/v1/mapping" class="external-link uri">https://isomemodb.com/testapi/v1/mapping</a>
</li>
</ul>
<p>For the production api use /api instead of /testapi</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing MpiIsoData</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>INWT Statistics GmbH <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by INWT Statistics GmbH.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
